"use strict";var PitchDetector=(()=>{var Bt=Object.create;var q=Object.defineProperty;var It=Object.getOwnPropertyDescriptor;var xt=Object.getOwnPropertyNames;var zt=Object.getPrototypeOf,Rt=Object.prototype.hasOwnProperty;var Mt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ct=(e,t)=>{for(var r in t)q(e,r,{get:t[r],enumerable:!0})},ft=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of xt(t))!Rt.call(e,s)&&s!==r&&q(e,s,{get:()=>t[s],enumerable:!(n=It(t,s))||n.enumerable});return e};var Vt=(e,t,r)=>(r=e!=null?Bt(zt(e)):{},ft(t||!e||!e.__esModule?q(r,"default",{value:e,enumerable:!0}):r,e)),Dt=e=>ft(q({},"__esModule",{value:!0}),e);var ut=Mt((Kt,lt)=>{"use strict";function g(e){if(this.size=e|0,this.size<=1||(this.size&this.size-1)!==0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1;for(var t=new Array(this.size*2),r=0;r<t.length;r+=2){let c=Math.PI*r/this.size;t[r]=Math.cos(c),t[r+1]=-Math.sin(c)}this.table=t;for(var n=0,s=1;this.size>s;s<<=1)n++;this._width=n%2===0?n-1:n,this._bitrev=new Array(1<<this._width);for(var o=0;o<this._bitrev.length;o++){this._bitrev[o]=0;for(var i=0;i<this._width;i+=2){var a=this._width-i-2;this._bitrev[o]|=(o>>>i&3)<<a}}this._out=null,this._data=null,this._inv=0}lt.exports=g;g.prototype.fromComplexArray=function(t,r){for(var n=r||new Array(t.length>>>1),s=0;s<t.length;s+=2)n[s>>>1]=t[s];return n};g.prototype.createComplexArray=function(){let t=new Array(this._csize);for(var r=0;r<t.length;r++)t[r]=0;return t};g.prototype.toComplexArray=function(t,r){for(var n=r||this.createComplexArray(),s=0;s<n.length;s+=2)n[s]=t[s>>>1],n[s+1]=0;return n};g.prototype.completeSpectrum=function(t){for(var r=this._csize,n=r>>>1,s=2;s<n;s+=2)t[r-s]=t[s],t[r-s+1]=-t[s+1]};g.prototype.transform=function(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null};g.prototype.realTransform=function(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null};g.prototype.inverseTransform=function(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=1,this._transform4();for(var n=0;n<t.length;n++)t[n]/=this.size;this._out=null,this._data=null};g.prototype._transform4=function(){var t=this._out,r=this._csize,n=this._width,s=1<<n,o=r/s<<1,i,a,c=this._bitrev;if(o===4)for(i=0,a=0;i<r;i+=o,a++){let l=c[a];this._singleTransform2(i,l,s)}else for(i=0,a=0;i<r;i+=o,a++){let l=c[a];this._singleTransform4(i,l,s)}var h=this._inv?-1:1,f=this.table;for(s>>=2;s>=2;s>>=2){o=r/s<<1;var _=o>>>2;for(i=0;i<r;i+=o)for(var v=i+_,b=i,u=0;b<v;b+=2,u+=s){let l=b,m=l+_,d=m+_,p=d+_,y=t[l],F=t[l+1],A=t[m],w=t[m+1],T=t[d],B=t[d+1],I=t[p],x=t[p+1],z=y,R=F,M=f[u],C=h*f[u+1],V=A*M-w*C,D=A*C+w*M,P=f[2*u],K=h*f[2*u+1],G=T*P-B*K,H=T*K+B*P,J=f[3*u],Q=h*f[3*u+1],U=I*J-x*Q,W=I*Q+x*J,X=z+G,E=R+H,S=z-G,Y=R-H,Z=V+U,N=D+W,$=h*(V-U),j=h*(D-W),L=X+Z,O=E+N,tt=X-Z,rt=E-N,st=S+j,nt=Y-$,et=S-j,ot=Y+$;t[l]=L,t[l+1]=O,t[m]=st,t[m+1]=nt,t[d]=tt,t[d+1]=rt,t[p]=et,t[p+1]=ot}}};g.prototype._singleTransform2=function(t,r,n){let s=this._out,o=this._data,i=o[r],a=o[r+1],c=o[r+n],h=o[r+n+1],f=i+c,_=a+h,v=i-c,b=a-h;s[t]=f,s[t+1]=_,s[t+2]=v,s[t+3]=b};g.prototype._singleTransform4=function(t,r,n){let s=this._out,o=this._data,i=this._inv?-1:1,a=n*2,c=n*3,h=o[r],f=o[r+1],_=o[r+n],v=o[r+n+1],b=o[r+a],u=o[r+a+1],l=o[r+c],m=o[r+c+1],d=h+b,p=f+u,y=h-b,F=f-u,A=_+l,w=v+m,T=i*(_-l),B=i*(v-m),I=d+A,x=p+w,z=y+B,R=F-T,M=d-A,C=p-w,V=y-B,D=F+T;s[t]=I,s[t+1]=x,s[t+2]=z,s[t+3]=R,s[t+4]=M,s[t+5]=C,s[t+6]=V,s[t+7]=D};g.prototype._realTransform4=function(){var t=this._out,r=this._csize,n=this._width,s=1<<n,o=r/s<<1,i,a,c=this._bitrev;if(o===4)for(i=0,a=0;i<r;i+=o,a++){let it=c[a];this._singleRealTransform2(i,it>>>1,s>>>1)}else for(i=0,a=0;i<r;i+=o,a++){let it=c[a];this._singleRealTransform4(i,it>>>1,s>>>1)}var h=this._inv?-1:1,f=this.table;for(s>>=2;s>=2;s>>=2){o=r/s<<1;var _=o>>>1,v=_>>>1,b=v>>>1;for(i=0;i<r;i+=o)for(var u=0,l=0;u<=b;u+=2,l+=s){var m=i+u,d=m+v,p=d+v,y=p+v,F=t[m],A=t[m+1],w=t[d],T=t[d+1],B=t[p],I=t[p+1],x=t[y],z=t[y+1],R=F,M=A,C=f[l],V=h*f[l+1],D=w*C-T*V,P=w*V+T*C,K=f[2*l],G=h*f[2*l+1],H=B*K-I*G,J=B*G+I*K,Q=f[3*l],U=h*f[3*l+1],W=x*Q-z*U,X=x*U+z*Q,E=R+H,S=M+J,Y=R-H,Z=M-J,N=D+W,$=P+X,j=h*(D-W),L=h*(P-X),O=E+N,tt=S+$,rt=Y+L,st=Z-j;if(t[m]=O,t[m+1]=tt,t[d]=rt,t[d+1]=st,u===0){var nt=E-N,et=S-$;t[p]=nt,t[p+1]=et;continue}if(u!==b){var ot=Y,vt=-Z,mt=E,dt=-S,pt=-h*L,bt=-h*j,gt=-h*$,wt=-h*N,yt=ot+pt,At=vt+bt,Ft=mt+wt,Tt=dt-gt,ht=i+v-u,ct=i+_-u;t[ht]=yt,t[ht+1]=At,t[ct]=Ft,t[ct+1]=Tt}}}};g.prototype._singleRealTransform2=function(t,r,n){let s=this._out,o=this._data,i=o[r],a=o[r+n],c=i+a,h=i-a;s[t]=c,s[t+1]=0,s[t+2]=h,s[t+3]=0};g.prototype._singleRealTransform4=function(t,r,n){let s=this._out,o=this._data,i=this._inv?-1:1,a=n*2,c=n*3,h=o[r],f=o[r+n],_=o[r+a],v=o[r+c],b=h+_,u=h-_,l=f+v,m=i*(f-v),d=b+l,p=u,y=-m,F=b-l,A=u,w=m;s[t]=d,s[t+1]=0,s[t+2]=p,s[t+3]=y,s[t+4]=F,s[t+5]=0,s[t+6]=A,s[t+7]=w}});var $t={};Ct($t,{Autocorrelator:()=>k,PitchDetector:()=>at});var _t=Vt(ut(),1),k=class e{_inputLength;_fft;_bufferSupplier;_paddedInputBuffer;_transformBuffer;_inverseBuffer;static forFloat32Array(t){return new e(t,r=>new Float32Array(r))}static forFloat64Array(t){return new e(t,r=>new Float64Array(r))}static forNumberArray(t){return new e(t,r=>Array(r))}constructor(t,r){if(t<1)throw new Error("Input length must be at least one");this._inputLength=t,this._fft=new _t.default(Nt(2*t)),this._bufferSupplier=r,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}get inputLength(){return this._inputLength}autocorrelate(t,r=this._bufferSupplier(t.length)){if(t.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${t.length}`);for(let s=0;s<t.length;s++)this._paddedInputBuffer[s]=t[s];for(let s=t.length;s<this._paddedInputBuffer.length;s++)this._paddedInputBuffer[s]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);let n=this._transformBuffer;for(let s=0;s<n.length;s+=2)n[s]=n[s]*n[s]+n[s+1]*n[s+1],n[s+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let s=0;s<t.length;s++)r[s]=this._inverseBuffer[2*s];return r}};function Et(e){let t=[],r=!1,n=-1/0,s=-1;for(let o=1;o<e.length-1;o++)e[o-1]<=0&&e[o]>0?(r=!0,s=o,n=e[o]):e[o-1]>0&&e[o]<=0?(r=!1,s!==-1&&t.push(s)):r&&e[o]>n&&(n=e[o],s=o);return t}function St(e,t){let[r,n,s]=[e-1,e,e+1],[o,i,a]=[t[r],t[n],t[s]],c=o/2-i+a/2,h=-(o/2)*(n+s)+i*(r+s)-a/2*(r+n),f=o*n*s/2-i*r*s+a*r*n/2,_=-h/(2*c),v=c*_*_+h*_+f;return[_,v]}var at=class e{_autocorrelator;_nsdfBuffer;_clarityThreshold=.9;_minVolumeAbsolute=0;_maxInputAmplitude=1;static forFloat32Array(t){return new e(t,r=>new Float32Array(r))}static forFloat64Array(t){return new e(t,r=>new Float64Array(r))}static forNumberArray(t){return new e(t,r=>Array(r))}constructor(t,r){this._autocorrelator=new k(t,r),this._nsdfBuffer=r(t)}get inputLength(){return this._autocorrelator.inputLength}set clarityThreshold(t){if(!Number.isFinite(t)||t<=0||t>1)throw new Error("clarityThreshold must be a number in the range (0, 1]");this._clarityThreshold=t}set minVolumeAbsolute(t){if(!Number.isFinite(t)||t<0||t>this._maxInputAmplitude)throw new Error(`minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`);this._minVolumeAbsolute=t}set minVolumeDecibels(t){if(!Number.isFinite(t)||t>0)throw new Error("minVolumeDecibels must be a number <= 0");this._minVolumeAbsolute=this._maxInputAmplitude*10**(t/10)}set maxInputAmplitude(t){if(!Number.isFinite(t)||t<=0)throw new Error("maxInputAmplitude must be a number > 0");this._maxInputAmplitude=t}findPitch(t,r){if(this._belowMinimumVolume(t))return[0,0];this._nsdf(t);let n=Et(this._nsdfBuffer);if(n.length===0)return[0,0];let s=Math.max(...n.map(c=>this._nsdfBuffer[c])),o=n.find(c=>this._nsdfBuffer[c]>=this._clarityThreshold*s),[i,a]=St(o,this._nsdfBuffer);return[r/i,Math.min(a,1)]}_belowMinimumVolume(t){if(this._minVolumeAbsolute===0)return!1;let r=0;for(let n=0;n<t.length;n++)r+=t[n]**2;return Math.sqrt(r/t.length)<this._minVolumeAbsolute}_nsdf(t){this._autocorrelator.autocorrelate(t,this._nsdfBuffer);let r=2*this._nsdfBuffer[0],n;for(n=0;n<this._nsdfBuffer.length&&r>0;n++)this._nsdfBuffer[n]=2*this._nsdfBuffer[n]/r,r-=t[n]**2+t[t.length-n-1]**2;for(;n<this._nsdfBuffer.length;n++)this._nsdfBuffer[n]=0}};function Nt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}return Dt($t);})();
